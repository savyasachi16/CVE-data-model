from docopt import docopt
from database import Database
from download import Download
from parser import Parser
from config import GENERIC_FILEPATHS, RECENT_FILEPATH, MODIFIED_FILEPATH


class Driver:
    def __init__(self):
        self.downloader = Download()
        self.parser = Parser()
        self.db = Database()

    def rebuildDB(self):
        self.downloader.downloadAll()
        self.db.dropAllTables()
        self.db.createAllTables()
        for file in GENERIC_FILEPATHS:
            cves = self.parser.getCVEs(file)
            self.db.insertRows(cves)

    def updateDB(self):
        self.downloader.downloadModifiedFeed()
        self.downloader.downloadRecentFeed()
        recent_cves = self.parser.getCVEs(RECENT_FILEPATH)
        modified_cves = self.parser.getCVEs(MODIFIED_FILEPATH)
        self.db.updateRows(recent_cves)
        self.db.updateRows(modified_cves)

    def getTopVulnerableProducts(self):
        pass

    def getRoundedScoreCVECount(self):
        pass


if __name__ == "__main__":
    exe = Driver()
    exe.updateDB()
